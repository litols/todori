# 使い方ガイド

## 基本的なタスク管理

### タスクの作成

Claude Codeにタスクを作成するよう依頼するだけです：

```
タスクを作成: ユーザー認証を実装
```

詳細情報を追加することもできます：

```
タスクを作成: ダークモード対応を追加
説明: localStorageでの永続化を伴うテーマ切り替えを実装
優先度: 75
```

### タスクの一覧表示

すべてのタスクを表示：

```
すべてのタスクを表示
```

ステータスでフィルタ：

```
保留中のタスクをすべて表示
進行中のタスクを表示
```

### タスクの更新

タスクステータスの更新：

```
タスク「ユーザー認証を実装」を進行中にする
タスク「ダークモード対応を追加」を完了にする
```

タスク詳細の更新：

```
タスク「認証を実装」の優先度を90に更新
タスク「CIをセットアップ」に説明を追加: GitHub Actionsワークフローを設定
```

### タスクの依存関係

依存関係を持つタスクを作成：

```
タスクを作成: 本番環境にデプロイ
依存先: 統合テストを実行、ドキュメントを更新
```

Todoriは自動的に：
- 依存関係に基づいてタスクの優先度を計算
- 循環依存を防止
- タスク一覧表示時に依存関係グラフを表示

## タスクの展開

Todoriの最も強力な機能の1つは、Claude Codeのプロジェクト理解を使用した自動タスク展開です。

### サブタスクの自動生成

複雑なタスクを作成する際、Claude Codeに展開を依頼：

```
タスクを作成して展開: データベース層をリファクタリング
```

Claude Codeは：
1. コードベースを分析
2. 現在の実装を理解
3. タスクを具体的なサブタスクに分解
4. サブタスク間の依存関係を作成

### 手動展開

既存のタスクを展開することもできます：

```
タスクを展開: ユーザー認証を実装
```

## タスククエリ

### フィルタリング

様々な条件でタスクをフィルタ：

```
優先度70以上のタスクを表示
ブロックされているタスクを表示
「backend」タグのタスクを表示
```

### ソート

異なるフィールドでタスクをソート：

```
優先度順にタスクを表示
作成日順にタスクを一覧表示
```

### 検索

タスクのタイトルと説明で検索：

```
認証に関連するタスクを検索
「API」を含むタスクを検索
```

## タスクステータス

Todoriは以下のタスクステータスをサポート：

- **pending（保留中）**: 作業準備完了
- **in-progress（進行中）**: 現在作業中
- **blocked（ブロック中）**: 依存関係または外部要因を待機中
- **done（完了）**: タスク完了
- **deferred（延期）**: 後で実施予定
- **cancelled（キャンセル）**: タスクキャンセル

## プロジェクトコンテキスト

### セッションの永続化

タスクはClaude Codeセッション間で永続化されます。同じプロジェクトで新しいセッションを開始すると、すべてのタスクが自動的に復元されます。

### プロジェクト検出

Todoriは以下を探すことでプロジェクトを自動検出：
- Gitリポジトリルート
- パッケージマネージャーファイル
- 一般的なプロジェクトマーカー

タスクはプロジェクトルートの`.todori/tasks.yaml`に保存されます。

### マルチプロジェクトサポート

複数のプロジェクトで作業できます。各プロジェクトは独自の`.todori/`ディレクトリにタスクリストを保持します。

## マルチエージェント連携（ccmanager）

Todoriは並列開発ワークフロー向けに[ccmanager](https://github.com/kbwo/ccmanager)とシームレスに連携するマルチエージェントタスク調整機能をサポートしています。

### 概要

複数のClaude Codeセッション（例：異なるgit worktree）で作業する際、Todoriでは各セッションがタスクを「claim（取得）」でき、他のセッションが同じタスクで作業することを防ぎます。

```
┌─────────────────────────────────────────────────────────┐
│                    ccmanager                            │
├──────────────┬──────────────┬──────────────────────────┤
│ Worktree A   │ Worktree B   │ Worktree C              │
│ (feature-1)  │ (feature-2)  │ (bugfix-1)              │
├──────────────┼──────────────┼──────────────────────────┤
│/todori-claim │/todori-claim │/todori-claim            │
│  → Task T1   │  → Task T2   │  → Task T3              │
│              │              │                          │
│ ... 作業 ... │ ... 作業 ... │ ... 作業 ...            │
│              │              │                          │
│/todori-done  │/todori-done  │/todori-release          │
│  → T1 完了   │  → T2 完了   │  → T3 解放              │
└──────────────┴──────────────┴──────────────────────────┘
```

### マルチエージェントワークフロー用コマンド

#### `/todori-claim` - 次のタスクを取得

現在のセッション用に次の利用可能なタスクを取得：

```
/todori-claim                    # セッションIDを自動検出
/todori-claim feature-auth       # セッションIDを手動指定
```

このコマンドは：
1. 次の未割り当てタスクを検索（依存関係と優先度を考慮）
2. タスクステータスを`in-progress`に設定
3. タスクを自分のセッションに割り当て

セッションIDは以下の順序で検出：
1. コマンド引数（指定された場合）
2. `CCMANAGER_WORKTREE_BRANCH`環境変数
3. `CCMANAGER_SESSION_ID`環境変数
4. 現在のgitブランチ名
5. フォールバックとして"default"

#### `/todori-release` - タスクを解放

完了せずに取得したタスクを解放：

```
/todori-release              # 現在の進行中タスクを解放
/todori-release abc-123      # IDで特定のタスクを解放
```

これにより担当者がクリアされ、他のセッションがタスクを利用可能になります。

#### `/todori-status` - マルチセッション概要

全セッションのタスク状況を表示：

```
/todori-status
```

出力内容：
- セッション/担当者別にグループ化されたタスク
- 取得可能な未割り当てタスク
- 最近完了したタスク

### ccmanagerとの使用方法

1. **ccmanagerをインストール**：
   ```bash
   npm install -g ccmanager
   ```

2. **並列作業用のworktreeを作成**：
   ```bash
   # ccmanagerがgit worktreeを自動管理
   ccmanager
   ```

3. **各セッションで**、Todoriコマンドを使用：
   ```
   /todori-claim          # 次の利用可能なタスクを取得
   # ... タスクに取り組む ...
   /todori-done           # 完了したら完了マーク
   ```

4. **ステータスフック**（オプション）：セッション状態変化時にTodoriコマンドを実行するようccmanagerを設定。

### API サポート

以下のMCPツールがマルチエージェント調整をサポート：

#### `get_next_task`と`currentSessionId`

```typescript
// 他のセッションに割り当てられたタスクを除外
get_next_task({
  currentSessionId: "feature-1"
})
```

#### `update_task`と`assignee`

```typescript
// タスクをセッションに割り当て
update_task({
  id: "task-uuid",
  status: "in-progress",
  assignee: { sessionId: "feature-1" }
})

// 担当者をクリア
update_task({
  id: "task-uuid",
  assignee: null
})
```

### タスクの担当者

各タスクはオプションの`assignee`フィールドを持つことができます：

```yaml
tasks:
  - id: 550e8400-e29b-41d4-a716-446655440000
    title: ユーザー認証を実装
    status: in-progress
    assignee:
      sessionId: feature-1
      assignedAt: 2025-12-15T10:30:00Z
```

## 高度な機能

### サブタスク

複雑なタスクをサブタスクに分解：

```
「認証を実装」にサブタスクを追加: ユーザーモデルを作成
「認証を実装」にサブタスクを追加: JWTミドルウェアをセットアップ
「認証を実装」にサブタスクを追加: ログインエンドポイントを追加
```

### タスクメタデータ

すべてのタスクにはメタデータが含まれます：
- 作成タイムスタンプ
- 最終更新タイムスタンプ
- 完了タイムスタンプ（完了タスクの場合）
- 自動計算された優先度

### 依存関係グラフ

完全な依存関係グラフを表示：

```
タスク「本番環境にデプロイ」の依存関係グラフを表示
```

## ベストプラクティス

### 1. 説明的なタイトルを使用

良い例：
```
タスクを作成: Googleプロバイダーを使用したOAuth2認証を実装
```

あまり良くない例：
```
タスクを作成: 認証を追加
```

### 2. 適切な優先度を設定

- 90-100: 重要、他の作業をブロックしている
- 70-89: 高優先度、早めに実施すべき
- 40-69: 中優先度、通常の作業
- 20-39: 低優先度、あると良い
- 0-19: 非常に低い優先度、将来の作業

### 3. 大きなタスクを分解

以下の代わりに：
```
タスクを作成: フロントエンド全体を構築
```

このようにする：
```
タスクを作成: Reactプロジェクトをセットアップ
タスクを作成: コンポーネントライブラリを実装
タスクを作成: ルーティングを追加
タスクを作成: APIと統合
```

### 4. 依存関係を使用

関連するタスクを接続：
```
タスクを作成: 統合テストを書く
依存先: APIエンドポイントを実装

タスクを作成: ステージング環境にデプロイ
依存先: 統合テストを書く、ドキュメントを更新
```

### 5. タスクを最新に保つ

現在の作業を反映するため、定期的にタスクステータスを更新：
```
タスクを開始: コンポーネントライブラリを実装
タスクを完了: Reactプロジェクトをセットアップ
```

## ヒントとコツ

### クイックタスク作成

複数のタスクを一度に作成：
```
これらのタスクを作成:
- 開発環境をセットアップ
- リンティングを設定
- pre-commitフックを追加
```

### コンテキスト認識の展開

展開前にClaude Codeにプロジェクトを分析させる：
```
現在の認証実装を確認してから、タスクを展開: OAuth2に移行
```

### 完了前のレビュー

タスクを完了としてマークする前に、Claude Codeに確認させる：
```
タスク「認証を実装」が完了しているかレビュー
```

## 次のステップ

- [完全なAPIリファレンスを見る](/ja/api/reference)
- [GitHubで例を見る](https://github.com/litols/todori/tree/main/examples)
